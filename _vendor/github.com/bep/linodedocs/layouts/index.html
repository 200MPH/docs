{{ define "head" }}
  <meta name="turbolinks-cache-control" content="no-preview">
{{ end }}

{{ define "main" }}
  {{/* Set up the static content shown on this page. See content/headless/home for the queries. */}}
  {{ $articleFeatured := "" }}
  {{ $articleStarters := slice }}
  {{ $headlessSection := site.GetPage "headless" }}
  {{ $whereDoIStart := $headlessSection.GetPage "home/where-do-i-start" }}
  {{ with $whereDoIStart }}
    {{ $whereDoIStartData := .Resources.GetMatch "data.*" | transform.Unmarshal }}
    {{ $articleFeatured = index (partial "funcs/build-query.html" $whereDoIStartData.queries.featured) 0 }}
    {{ $articleStarters = partial "funcs/build-query.html" $whereDoIStartData.queries.getting_started | first 2 }}
  {{ end }}
  
  <div id="home-component" x-data="lnHome.New(lnSearchConfig)" x-init="() => mounted()"
    @search:results-blank.once.document="receiveCommonData($event.detail)" 
    @search:data-home.document="receiveData($event.detail);">
    <section class="mb-10">
      <div class="mb-10" style="max-width: 864px;">
        <h1 class="pb-5 text-4xl md:text-5xl">
          {{ .Params.h1_title | default .Title }}
        </h1>
        <div class="text-lg leading-6 text-textcolor">
          {{ .Summary }}
        </div>
      </div>
    </section>
    <section class="kind-home__products-tiles mb-8">
      {{ template "home/products-strip" (dict "section" "products" "title" "Products") }}
    </section>
    {{ with $articleFeatured }}
      <section class="mb-8 py-8 bg-gradient-to-r from-gray-200 to-gray-300 full-width pull-out">
        <div class="flex flex-col md:flex-row h-auto container">
          <div class="w-full md:w-2/3 md:mr-7">
            {{ partial "helpers/bundle-image.html" (dict "page" . "class" "rounded-lg" "command" "Fit" "options" "693x364 center") }}
          </div>
          <div class="w-full md:w-1/3 flex flex-col">
            <span class="text-basicgray uppercase text-sm hidden md:inline">
              Featured Doc
            </span>
            <h2 class="mt-4 md:mt-3 text-center md:text-left">
              {{ .Title }}
            </h2>
            <p class="text-lg mt-4 hidden md:inline">
              {{ .Summary }}
            </p>
            <a href="{{ .RelPermalink }}" class="mt-6 text-center md:text-left">
              <button class="w-full md:w-40 h-10 md:h-16 border-2 text-sm md:text-lg font-semibold text-green-500 hover:text-opacity-75 border-brand rounded-md">
                Read the Doc
              </button>
            </a>
          </div>
        </div>
      </section>
    {{ end }}
    <section class="mb-10">
      {{ template "home/section-tiles" (dict "section" "docs" "title" "Guides") }}
    </section>
    <section class="mb-10">
      {{ template "home/section-tiles" (dict "section" "blog" "title" "Blogs") }}
    </section>
    <section class="mb-10">
      {{ template "home/section-tiles" (dict "section" "resources" "title" "Resources") }}
    </section>
    <section class="mb-10">
      {{ template "home/section-tiles" (dict "section" "marketplace" "title" "Marketplace") }}
    </section>
    {{ with $articleStarters }}
      <section class="mb-8 py-8 bg-gradient-to-r from-gray-200 to-gray-300 full-width pull-out">
        <div class="flex w-full space-x-4 h-auto container">
          {{ range . }}
            <div class="w-1/2">
              <div class="w-full">
                {{ partial "helpers/bundle-image.html" (dict "page" . "class" "rounded-lg" "command" "Fit" "options" "514x270 center") }}
              </div>
              <a href="{{ .RelPermalink }}" class="hover:text-basicgray">
                <div class="w-full flex flex-col mt-4">
                  <h2 class="mt-4 md:mt-3 text-base md:text-2xl">
                    {{ .Title }}
                  </h2>
                  <p class="text-sm mt-4 hidden md:inline">
                    {{ .Summary }}
                  </p>
                  <span class="hidden md:inline mt-6 text-sm text-green-500 hover:text-opacity-75 text-center md:text-left">
                    Read the Doc
                  </span>
                </div>
              </a>
            </div>
          {{ end }}
        </div>
      </section>
    {{ end }}
  </div>
{{ end }}

{{ define "home/section-title"}}
  <template x-if="data.sectionMeta.{{ $.section }}">
    <div class="flex items-center">
      <h2 class="text-3 md:text-3xl">
        {{ .title }}
      </h2>
      <a class="text-xs md:text-sm text-basicgray ml-3 flex items-center" :href="data.sectionMeta.{{ $.section }}.href">
        Browse All
        <svg class="w-2 h-3 ml-2 text-basicgray btn-icon">
          <use href="#icon--arrow-right"></use>
        </svg>
      </a>
    </div>
  </template>
{{ end }}

{{ define "home/products-strip-tile" }}
  <div class="kind-home__tile {{ . }}" x-show.transition.duration.500ms.in.origin.left="item.href">
    <a class="h-40 w-40 flex items-center rounded-lg text-gray-700" :href="item.href">
      <div class="flex flex-col justify-center w-full">
        <div class="w-full flex justify-center mb-2">
          <div class="w-16 h-16" :x-ref="item.href" x-html="lnSvgLoader.Load($refs[item.href], item.icon)"></div>
        </div>
        <h3 x-html="item.title" class="text-center text-lg mb-2" style="letter-spacing: -0.2px;"></h3>
        <span x-html="item.count + ' Docs'" class="text-center text-basicgray text-sm" style="letter-spacing: -0.3px;"></span>
      </div>
    </a>
  </div>
{{ end }}

{{ define "home/products-strip"}}
  <div class="mt-8 w-full h-56"
  :class="{
    'invisible': !data.loaded,
    'visible': data.loaded
  }">
    <div x-show.transition.in.origin.top.left="data.loaded">
      <div class="flex items-center justify-between">
        {{ template  "home/section-title" . }}
        <div class="mr-8 hidden md:flex space-x-1">
          <template x-for="(bar, i) in data.productTiles.progress()">
            <div style="height: 3px; width: 16px"
            :class="{
              'bg-brand': bar,
              'bg-gray-500': !bar
            }"
          ></div>
          </template>
        </div>
      </div>
      <div class="flex flex-no-wrap content-start w-full mt-7">
        <button x-bind:disabled="data.productTiles.low === 0"
      class="btn-icon -ml-10 w-10 hidden md:block" @click="data.productTiles.prev()">
          <svg class="w-3" style="display: block; transform: scale(-1,1)" >
            <use href="#icon--arrow-right"></use>
          </svg>
        </button>
        <div x-ref="tiles-products" class="flex flex-no-wrap w-full space-x-2" :class="{ 'justify-between': data.productTiles.current().length === 6}">
          <template x-for="(item, i) in data.productTiles.current()" :key="item.href">
            {{ template "home/products-strip-tile" }}
          </template>
          {{/* On mobile (with no arrow buttons), we show a small part of the next tile to hint at swiping. */}}
          <template x-if="data.productTiles.hasNext()">
            <template x-for="(item, i) in data.productTiles.peek().slice(0, 1)" :key="item.href">
              {{ template "home/products-strip-tile" "md:hidden" }}
            </template>
          </template>
        </div>
        <button class="ml-8 -mr-10 object-right btn-icon hidden md:block" 
       @click="data.productTiles.next()" x-bind:disabled="!data.productTiles.hasNext()">
          <svg class="w-3">
            <use href="#icon--arrow-right"></use>
          </svg>
        </button>
      </div>
    </div>
  </div>
{{ end }}

{{ define "home/section-tiles-item"}}
  <div class="kind-home__tile md:w-1/4 {{ . }}" x-show.transition.duration.500ms.in.origin.left="item.objectID">
    <div class="bg-white h-full rounded-lg overflow-hidden shadow-sm  hover:shadow-lg">
      <a :href="item.href" class="no-underline block">
        <div class="relative overflow-hidden pb-16/9">
          <img :src="item.thumbnailUrl" class="absolute h-full w-full object-cover" loading="lazy">
        </div>
        <div class="px-4 pt-4 pb-6">
          <h3 class="two-line-ellipsis font-semibold text-sm md:text-lg text-gray-700" x-html="item.title"></h3>
        </div>
      </a>
    </div>
  </div>
{{ end }}

{{ define "home/section-tiles"}}
{{ $section := .section }}
<div class="w-full kind-home__sections-tiles" x-show.transition.in.origin.top.left="data.loaded">
  {{ template  "home/section-title" . }}
  {{ $section := .section }}
  <div class="flex flex-no-wrap content-start w-full mt-8">
    <button  x-bind:disabled="!data.sectionTiles.{{ $section }}.hasPrev()" class="btn-icon"
           @click="data.sectionTiles.{{ $section }}.prev()">
      <svg class="-ml-10 w-3" style="display: block; transform: scale(-1,1)" >
        <use href="#icon--arrow-right"></use>
      </svg>
    </button>
    <div x-ref="tiles-{{ $section }}" class="flex flex-no-wrap w-full space-x-4">
      <template x-for="(item, i) in data.sectionTiles.{{ $section }}.current()" :key="item.objectID">
        {{ template "home/section-tiles-item" }}
      </template>
      {{/* On mobile (with no arrow buttons), we show a small part of the next tile to hint at swiping. */}}
      <template x-if="data.sectionTiles.{{ $section }}.hasNext()">
        <template x-for="(item, i) in data.sectionTiles.{{ $section }}.peek().slice(0, 1)" :key="item.objectID">
          {{ template "home/section-tiles-item" "md:hidden" }}
        </template>
      </template>
    </div>
    <button x-bind:disabled="!data.sectionTiles.{{ $section }}.hasNext()"
      class="btn-icon ml-8 -mr-10 object-right" @click="data.sectionTiles.{{ $section }}.next()">
      <svg class="w-3">
        <use href="#icon--arrow-right"></use>
      </svg>
    </button>
  </div>
{{ end }}

{{/* TODO(bep) remove me if still unused. */}}
{{ define "home/collect-products-icons" }}
  {{ $s := .s }}
  {{ $m := .m }}
  {{ $ic := ($s.Resources.GetMatch "feature.svg" ) }}
  
  {{ with $ic }}
    {{ $svg := .Content }}
    {{ $path := replaceRE `(?s).*(<g.*>.*</g>).*` "<g>$1</g>" $svg}}
    {{ $viewBox := replaceRE `(?s).*viewBox=\"(.*?)\".*` "$1" $svg}}
    {{ $m.Add "icons" (dict "id" .RelPermalink "path" ($path | safeHTML) "viewBox" $viewBox)}}
  {{ end }}
  {{ range $s.Sections }}
    {{ template "home/collect-products-icons" (dict "m" $m "s" . )}}
  {{ end }}
{{ end }}